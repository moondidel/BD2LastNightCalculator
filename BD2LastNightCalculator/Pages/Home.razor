@page "/"

<MudText Typo="Typo.h4" Class="mb-4">캐릭터 배치 (드래그해서 순서 변경)</MudText>

@* T="CharacterItem"을 명시하여 데이터 타입을 확정합니다 *@
<MudDropContainer T="CharacterItem" Items="_items" ItemsSelector="@((item, zone) => item.Identifier == zone)" ItemDropped="ItemUpdated" Class="d-flex flex-column">
    <ChildContent>
        @* Identifier가 드롭존과 일치해야 합니다 *@
        <MudDropZone T="CharacterItem" Identifier="dropzone" Class="mud-alert-info pa-4 rounded-lg" Style="min-height:200px;" />
    </ChildContent>
    <ItemRenderer>
        <MudPaper Class="pa-4 my-2 d-flex align-center" Elevation="2" Style="cursor: grab;">
            @* 드래그 핸들 아이콘 *@
            <MudIcon Icon="@Icons.Material.Filled.DragIndicator" Class="mr-4" />

            @* 캐릭터 이름 (고정폭) *@
            <MudText Style="width: 120px;" Typo="Typo.body1"><b>@context.Name</b></MudText>

            @* 공격력 입력창 *@
            <MudNumericField @bind-Value="context.Power" Label="공격력/마력"
                             Variant="Variant.Outlined" Margin="Margin.Dense" Class="mx-2" Style="width: 150px;" />

            @* 치명 피해 입력창 *@
            <MudNumericField @bind-Value="context.CritDamage" Label="치피(%)"
                             Variant="Variant.Outlined" Margin="Margin.Dense" Class="mx-2" Style="width: 120px;" />

            <MudSpacer />

            @* 현재 캐릭터의 간이 점수 계산 (예시: 공격력 * 치피) *@
            <MudText Typo="Typo.body2" Color="Color.Primary">
                예상 기여: @(context.Power * (1 + context.CritDamage / 100))
            </MudText>
        </MudPaper>
    </ItemRenderer>
</MudDropContainer>

@code {
    private List<CharacterItem> _items = new()
    {
        new CharacterItem { Name = "유스티아", Power = 5500 },
        new CharacterItem { Name = "세헤라자드", Power = 4800 },
        new CharacterItem { Name = "라텔", Power = 4200 },
    };

    private void ItemUpdated(MudItemDropInfo<CharacterItem> dropInfo)
    {
        // null 체크를 추가하여 CS8604 경고를 해결합니다.
        if (dropInfo.Item is null) return;

        _items.Remove(dropInfo.Item);
        _items.Insert(dropInfo.IndexInZone, dropInfo.Item);
    }

    public class CharacterItem
    {
        public string Name { get; set; } = "";
        public int Power { get; set; }  // 공격력/마력
        public double CritDamage { get; set; } // 치명 피해 (%)
                                               // 추가하고 싶은 스탯(예: 속성 강화 등)을 여기에 더 넣을 수 있습니다.

        // 이 줄을 추가하세요! (아이템이 'dropzone'이라는 구역에 속해있음을 알려주는 용도)
        public string Identifier { get; set; } = "dropzone";
    }


}